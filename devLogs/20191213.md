# 菜谱
* 指在游戏文件内的，由菜品层级数据、最终菜谱模型组成的数据文件。
会影响菜谱的行为
* 玩家在烹饪时加入的材料及其量、进行的操作及其顺序、各加热阶段进行时长、提交时菜肴拼盘的模型都会计入菜谱。

## 菜谱生成机制
菜谱是一个层的嵌套结构。
首先，制作菜肴的流程结构如图：
 
图中[a][b][c]指的是主料标签。实际上，在我们进行烹饪的时候，是先对A进行操作还是先对B进行操作并不会对菜肴的实质产生影响，只要进行下一步需要A、B的操作时，A和B都进行了所需的过程即可。譬如：制作番茄炒蛋时，最终一轮炒制中，只需要下锅时有煎好的蛋、切好的番茄、切好的葱、切好的蒜即可，之于先切番茄还是先切蒜，并没有硬性规定。

所以，我们需要引入层级概念。在最终提交后逐层拆开，并以此记录菜谱。以上图为例进行层级展开：
> 第一层
>     <div class="mermaid" id="mermaid" style="text-align:center">
        graph LR
        A[成品A] -->B[中间品B]
        B -->C[中间品D]
        B -->D[中间品C] 
    </div>

> 第二层
>     <div class="mermaid" id="mermaid" style="text-align:center">
        graph LR
        A[成品A] -->B[中间品B]
        B -->C[中间品C]
        B -->D[中间品D]
        D -->E[中间品E]
        D -->F[材料F]
    </div>
 
> 第三层
>      <div class="mermaid" id="mermaid" style="text-align:center">
        graph LR
        A[成品A] -->B[中间品B]
        B -->C[中间品C]
        B -->D[中间品D]
        D -->E[中间品E]
        D -->F[材料F]
        E -->G[中间品G]
        E -->H[材料H]
    </div>

 
每个分层的节点（展开图里的绿色圆形）记录了他们的处理方式，如加料、操作a、操作b等。

菜谱的层级有分支，在同一层级内分支之间互不影响，相对独立。
## 菜谱的重现

对于已经在数据库中出现的菜谱；若玩家再次以同样的材料、同样的加工工序、同样的加热方式制作菜肴，那起锅时玩家将直接得到目标菜谱的模型。玩家可以在这个基础上再次进行拼盘，再次提交时，新拼盘的模型将替代原来的模型。

当玩家重现菜谱并不代表着玩家将会做出点数完全一致的菜肴，由于玩家每一次制作时过程参数并不会相同（源于加热时长、翻炒次数等的不同），菜肴的点数依然有着区别。
菜谱的匹配机制
在玩家某一新菜肴制作完成后，对玩家刚刚制作的菜肴进行层级展开并逐层逐节点匹配，若完全吻合，视为菜谱重现。
